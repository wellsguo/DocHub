## 图像理论

图像理论认为——任何一副平面图像是由许多频率不同振幅不同的 X-Y 方向的空间频率波叠加而成。高空间频率波决定图像的细节，低空间频率波决定图像的背景和动态范围。

图像理论——研究空间率和空间频域（变换域）的问题。

## 遥感图像的波普范围

- 紫外线 0.01-0.38 um
- 可见光 0.38-0.76 um
- 红外线 0.76-1000 um
- 微波 0.1-100cm

## 基本概念

- 图像表示  
光源 &#8594; 物体 &#8594; 成像 &#8594; 数字化 


- 像素  
数字图像的基本要素


- 像素值  
对单个像素灰度值进行数字化采样


- 图像尺寸  
一般采用均匀采样（像素行列之间间隔相等）


- 数字表示  
  - 二维离散函数 $I = f(x,y)$, $x$,$y$表示坐标, $f$ 表示$(x,y)$处亮度值
  - 二维矩阵 $A[m,n]$


- 图像质量
  - 灰度  
    表示图像像素敏感程度的数值
  - 灰度值  
    表示图像不同灰度的最大数值
  - 对比度  
    最大灰度值 / 最小灰度值


- 图像质量评价
  - 主管评价
  - 客观评价 
    - 传统评价方法
      - MSE    
        $MSE = \frac{1}{M * N}\sum_{i=1}^{N}\sum_{j=1}^{M}({f_{ij}-f^{'}_{ij})^2} $ 
      - PSNR(SNR)  
        $PSNR = 10 log_{10}{\frac{L^2}{MSE}}$
    - 新方法研究
      基于人类视觉特性的影像质量评价方法（HSV）

- 图像颜色  
人类对光本质认识的三个阶段：
  - 光微粒子  
    反射、折射、透射 （牛顿）
  - 光波  
    干涉、衍射 (惠更斯)
  - 光（量）子  
    光电效应、康普顿效应 (爱因斯坦、普朗克)



- 三基色理论  
  $F = \alpha(R) + \beta(G) + \gamma(B) $
  - $R$  700 nm
  - $G$  546 nm
  - $B$  435.8 nm


- 颜色模型  
  - RGB  
   主动发光，多用于显示器  
  - CMYK  
   减色系统，多用于印刷、绘画  
  - HSI  
   图像处理最常用，色调(Hue)，色饱和度(Saturation)，亮度(Intensity)  
   HSI 可分开处理，而且相互独立  
  - CIE 


- 颜色模型应用  
  - 色彩调整  
  - 图像增强  
  - 图像融合  
  - 实例  
    HSI 模型消除红眼

- 伪彩色图像  
  将灰度图像变换为彩色图像
    -  颜色映射表

- 传统图像描述  
  - 矩阵  
    - 黑白图像 (二值图像) [0,1]
    - 灰度图像 [0~255]
    - 彩色图像
  
  - 链表  
    - 描述目标物体的边界  

  - 拓扑
    - 描述一组图形及其相互关系（包含关系）

  - 关系结构 
    - 描述一组物体及其相关关系
  
  - 距离  
    描述图像中像素之间的距离
    - 欧几里得距离  
      $d_E((i,j),(h,k))=\sqrt{(i-h)^2+(j-k^2)}$
    - 小区距离（曼哈度距离）  
      $d_M((i,j),(h,k))= |i-h|+|j-k|$
    - 棋盘距离  
      $d_G((i,j),(h,k))= max\{|i-h|,|j-k|\}$
 
  - 像素邻域  
     - $N_4(P)$  
     - $N_8(P)$  


- 图像存储  
  - 编码方式  
    - 无压缩
    - 无损压缩
    - 有损压缩
  - 常用图像格式  
    - 裸数据 （RAW）
    - 格式化存储 （.bmp, .jpeg, .tiff, .gif, ...） 


- 图像采样  

## 图像运算  

### 点运算  

#### 线性运算  

$I_{out}= f(I_{in}) = aI_{in} + b$

#### 非线性运算  

$I_{out}= f(I(x,y)) = I(x,y) + c * I(x,y) * (I(x,y)_m - I(x,y))$

#### 映射表点运算  

|In| 0 | 1 | 2 | ... |
| -- | -- | -- | -- | -- |
| Out | 4 | 6 | 7 | ... |

### 代数运算

#### 加法 

- $C(x,y) = A(x,y) + B(x,y)$ 
- 去除 “叠加性” 噪声 $g(x,y) = (g_0(x,y) + g_1(x,y) + ... + g_m(x,y)) / m$  
- 生成图像叠加效果 $g(x,y) = \alpha * f(x,y) + \beta * f(x,y)$, where $\alpha + \beta = 1$

#### 减法

- $C(x,y) = A(x,y) - B(x,y)$ 
- 去除不需要的叠加性图案 (天气预报蓝板) 
- 检测同一场景两幅图像的变化

#### 乘法
 - $C(x,y) = A(x,y) * B(x,y)$  
 - 图像的局部显示

### 逻辑运算

#### 求返 

$g(x,y) = R - f(x,y)$ 

- 负像
- 子图的补图


## 图像变换

### 空域变换

在图像空间，对图像的形状、像素值等进行变化、映射等

#### 几何变换

##### 基本几何变换

- 坐标空间变换  
  - 范围变化 (平移、翻转)
  - 大小变化 (缩放)

- 像素值变换
  - 像素值不发生变化，位置发生变化
  - 像素值发生变化（旋转、缩放、变形变换...）

#### 非几何变换

- 灰度直方图  
灰度级分布情况的统计表  
  - 空间信息全部丢失
  - 图像中对应的像素个数可直接得到
  - 任意一副图像对应一个直方图，反之不然 
  - 各子图直方图之和为全图直方图

- 直方图均衡  
$S = \int_{0}^{r}P_r(w)dw = \sum_{i=0}^{k}P_r(i)$  

#### 图像正交变换

### 频域变换

离散余弦变换、沃尔什变换、哈达玛变换、Harr变换、小波变换、霍特林变换 ...

- 系统描述  
$x(t)$输入 &#8594; **`系统`** &#8594; $y(t)$输出

#### 线性系统  
$\left.
\begin{aligned}
x_1(t) -> y_1(t)\\
x_2(t) -> y_2(t)
\end{aligned}
\right\}$
->
$\begin{cases}
x_1(t) + x_2(t) -> y_1(t) + y_2(t)\\
\alpha * x(t) -> \alpha * y(t)
\end{cases}$

<!-- $
\left.
\begin{aligned}
\left.
\begin{aligned}
\text{条件1}\\
\text{条件2}
\end{aligned}
\right\}\text{结论1}\\
\left.
\begin{aligned}
\text{条件2}\\
\text{条件3}
\end{aligned}
\right\}\text{结论2}
\end{aligned}
\right\}\text{结论}
$ -->

  - 线性系统，平移不变性质  
    $x(t-T) -> y(t-T)$

#### 正交函数集合  
   $u = {u_0(t), u_1(t), ...}$  
   $\int_{t_0}^{t_0+T}u_m(t)u_n(t)=\begin{cases}
    c & m = n \\
    0 & m \neq n
\end{cases}$
  
  - 物理意义  
    机轴方向上相互正交

  - 正交集合的完备性

  - 变换核可分离性  
  **满足正交完备两个条件的函数或举证才能用于图像的分析。**

- 调谐信号（欧拉公式）  
$f(t) = e^{jwt} = cos(wt) + jsin(wt)$, where $j^2 = -1$.

#### 傅里叶变换

$F(u) = | F(u) |e^{j\theta(u)}$ -> $F(u) = \int_{-\infty}^{+\infty}f(x)e^{-j2\pi ux}dx$

-  f(x) 振幅  
$F(u) = \sqrt{R^2(u) + I^2(u)}$

- f(x) 相位谱  
$\phi{(u)} = arctan\frac{I(u)}{R(u)}$


#### K-L 变换

传输 N 次，针对广泛的随机图像.

- 原理  
$\vec{X} = [x_1, x_2, ... , x_n]^T$ -> $\vec{Y} = [y_1, y_2, ... , y_n]^T$  

- 本质  
输入随机向量 $\vec{X}$ 中个分量之间存在很强的相关性，通过变换后输出随机向量 $\vec{Y}$ 中个分量之间互不相关。

- K-L变换性质
  - 去相关性：Y 向量的各分量互不相关
  - 最佳重构性：

#### 哈尔变换(正交、完备)

哈尔函数定义：令整数 $ 0  \leq k  \leq N-1$，由其他两个正整数 $p$, $q$ 唯一决定 $k = 2 ^ p + q - 1$, 哈尔变换函数定义为, $h_0 = \frac{1}{N}$, 
$h_k=\begin{cases}
2^{\frac{p}{2}} & \frac{q-1}{p} < x < \frac{q-0.5}{2^p}\\
-2^{\frac{p}{2}} & \frac{q-0.5}{2^p} \leq x < \frac{q}{2^p}\\
0 & others
\end{cases}$

哈尔变换均匀而迅速，反映尺度和位置。

#### 小波变换

傅里叶函数存在一定的局限。

- gabor 变换
- 短时傅里叶变换  
- 小波变换出现  
   频率不同、位置不同、宽度有限的基函数进行变换，Haar 是最早出现的小波变换
- 小波具有有限区间和均值为零的波  
- 小波 `vs` 傅里叶变换
   - 傅：
      - 意味着信号在任意时间区间与复数指数相乘，结果产生傅里叶函数
      - 按傅里叶系数，可将原信号分解成为不同频率的组合 
   - 小波：
      - 结果产生小波变换系数
      - 按照小波系数，原始信号分解为不同小波的组合



## 图像特征  

### 图像统计特征

- 均值  
$u = \frac{\sum_{y=0}^{M-1}\sum_{x=0}^{N-1}{f(x,y)}}{M*N}$

- 方差  
$\delta^2 = \frac{\sum_{y=0}^{M-1}\sum_{x=0}^{N-1}{(f(x,y)-u)^2}}{M*N}$

## 图像滤波  

### 空域滤波



#### 分类

- 数学形态学分类
   - 线性 f 
     - 高通、低通、带通
   - 非线性 f 
     - 最大值、最小值、中值  

- 处理结果
   - 平滑
   - 锐化



#### 微分滤波器 

- 微分求梯度，积分求均值  

$\begin{matrix}
Z_1 & Z_2 & Z_3 \\
Z_4 & Z_5 & Z_6 \\
Z_7 & Z_8 & Z_9
\end{matrix}$

$\triangledown f = mag(\triangledown f) = \sqrt{[(\frac{\partial F}{\partial x})^2 + (\frac{\partial F}{ \partial y})^2]}$

又 $\frac{dy}{dy} = \frac{y_1 - y_2}{\triangle x} = \frac{y(x+\triangle x) - y(x)}{\triangle x}$

在图像处理中，由于 x 是离散函数，故取 $\triangle x = 1$，则有 $\triangledown \approx \sqrt{(Z_5-Z_6)^2 + (Z_5-Z_8)^2}$




- 微分滤波器的两种特殊应用
  - 梯度 > T 时像素值赋值255，否则保留原值，结果边缘被突出，背景仍保留
  - 梯度 > T 时像素值赋值255，否则赋值为0，结果边缘被突出，图像被二值化

- 图像增强方法原理  
  $g(x,y) = h(x,y) + (a - 1)f(x,y)$, 其中， $g$ 增强后图像， $h$ 处理后的图像， $f$ 原图， $a$ > 1

##### 滤波算子

- 一阶滤波算子

 - Roberts 交叉算子 (2x2)  
  $\triangledown \approx |Z_5 - Z_9| + |Z_6- Z_8|$  
  $\begin{vmatrix}
1 & 0 \\
0 & -1
\end{vmatrix}$,
  $\begin{vmatrix}
0 & 1 \\
1 & 0
\end{vmatrix}$  
 - Prewitt (3x3)  
  $\triangledown \approx |(Z_7 + Z_8 + Z_9) - (Z_1 + Z_2 + Z_3) + (Z_3 + Z_6 + Z_9) - (Z_1 + Z_4 + Z_7)|$  
 - Sobel (3x3)  
  $\triangledown \approx |(Z_7 + 2 * Z_8 + Z_9) - (Z_1 + 2 * Z_2 + Z_3) + (Z_3 + 2 * Z_6 + Z_9) - (Z_1 + 2 * Z_4 + Z_7)|$  
- 二阶滤波算子  
$\triangledown ^2 F(x,y) = \frac{\partial ^2 F}{\partial x^2 } + \frac{\partial ^2 F}{\partial y^2 }$   
$G(x,y) = 4 * F(x,y) - F(x+1,y) - F(x-1, y) - F(x, y+1) - F(x, y-1)$
- 算子实例
  - prewitt  
    $\begin{vmatrix}
-1 & -1 & -1 \\
0 & 0 & 0 \\ 
1 & 1 & 1
\end{vmatrix}$  or  $\begin{vmatrix}
-1 & 0 & 1 \\
-1 & 0 & 1 \\ 
-1 & 0 & 1
\end{vmatrix}$
  - Sobel  
    $\begin{vmatrix}
-1 & -2 & -1 \\
0 & 0 & 0 \\ 
1 & 2 & 1
\end{vmatrix}$  or  $\begin{vmatrix}
-1 & 0 & 1 \\
-2 & 0 & 2 \\ 
-1 & 0 & 1
\end{vmatrix}$
  - Laplace  
  $\begin{vmatrix}
0 & -1 & 0 \\
-1 & 4 & -1 \\ 
0 & -1 & 0
\end{vmatrix}$ or   $\begin{vmatrix}
-1 & -1 & -1 \\
-1 & 8 & -1 \\ 
-1 & -1 & -1
\end{vmatrix}$ or $\begin{vmatrix}
1 & -2 & 1 \\
-1 & 4 & -1 \\ 
1 & -2 & 1
\end{vmatrix}$ or $\frac{1}{16}\begin{vmatrix}
-1 & -2 & -1 \\
-2 & 12 & -2 \\ 
-1 & -2 & -1
\end{vmatrix}$ or $\begin{vmatrix}
0 & -1 & 0 \\
-1 & A + 4 & -1 \\ 
0 & -1 & 0
\end{vmatrix}$ or $\begin{vmatrix}
-1 & -1 & -1 \\
-1 & A + 8 & -1 \\ 
-1 & -1 & -1
\end{vmatrix}$

#### 均值滤波器

邻域平均法能在一定程度上抑制噪声，但是邻域平均法的平均作用会引起模糊现象，模糊程度与邻域半径成正比。

#### 超限邻域平均法

如果葛某像素的灰度值大于其邻域像素的平均值且达到了一定水平，则判断该像素点为噪声点，继而用邻域像素的均值取代之。

$g(i,j) = \begin{cases}
\frac{1}{MN}\sum\sum_{(x,y)\in A}{f(x,y)} & |f(x,y) - \frac{1}{MN}\sum\sum_{(x,y)\in A}{f(x,y)}| > T\\
f(x,y) & others
\end{cases}$

#### 超限中值滤波

- 小结
  - 中值滤波的效果无论从客观指标还是主观视觉效果上都远远超过邻域平局值法  
  - 中值滤波后的图像边缘得到了较好的保护
  - 超限中值滤波比一般中值滤波效果更好

#### 偏值滤波器

$\begin{vmatrix}
-2 & -1 & 0 \\
-1 & 0 & 1 \\ 
0 & 1 & 2
\end{vmatrix}$

- 结果图像的像素值完全取决于该像素周边各点，而与其直接点无关
- 偏值滤波使结果图像具有某种浅浮雕阴影效果，在调查某些细节时，十分有用



### 频域滤波

在傅里叶变化域，变化系数反映了图像在空域难以定义的某些特征：
 - 频谱的直流低频分量对应于图像的平滑区域
 - 频谱的高频分量对应于图像的边缘或者变化剧烈的区域
 - 外界叠加噪声对应于频谱频率较高的部分 
 - 恒定的干扰条纹对应于频谱中某些特征点

#### 低通滤波器

##### 理想圆形低通滤波器(振铃效果)

##### Butter Worth 低通（没有明显振铃）
$H(u,v) = \frac{1}{1+ [ D(u,v)/D_0 ]}$

##### 指数低通

$H(u,v) = e^{-\frac{D(u,v)}{D_0}^n}$


##### 高斯低通

$H(u,v) = e^{- \frac{D(u,v)^2}{2 D_0^2}}$

##### 梯形低通

$H(u,v) = \begin{cases}
1 & D(u,v) < D_0\\
\frac{D_1 - D(u,v)}{D_1 - D_0} & D_0 < D(u,v) < D_1\\
0 & D1 < D
\end{cases}$

#### 高通滤波器

- $H(u,v) =  1 - lp(u,v)$
- IHPF
- BHPF
- GHPF
- THPF
- 改进措施  
   $ \frac{H(u,v) + A}{直方图均衡化} $
   - 上半部分类似于空域增益
   - 下半部分为后滤波处理

#### 通态滤波

- 成像过程
  $f(x,y) = i(x,y)r(x,y)$
  - $i(x,y)$ 入射光
  - $r(x,y)$ 反射光
- 入射光较均匀，随空间位置变化小(占据低频段)
- 反射光由于物体性质和结构特点不同而反射强弱很不相同的光，随空间位置变化比较剧烈(占据高频段比较宽的范围)
- 当入射光不均匀时，反射光构成的图像将难以表现物体的全貌(黑暗中照相->闪光灯)

### 小波变换滤波
图像相关性（系数）大，而噪声相关系数小

## 图像压缩

信息论中的信源编码理论解决的主要问题：
- 数据压缩的理论极限
- 数据压缩的基本途径

常见的压缩方法
- 霍夫曼编码
- 香农编码

