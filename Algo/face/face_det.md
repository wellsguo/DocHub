### 人脸检测

[1] https://www.jianshu.com/p/12463fa78eaa  
[2] http://www.cnblogs.com/fdggg/articles/2974754.html
[3] https://wenku.baidu.com/view/9212a563abea998fcc22bcd126fff705cd175c41.html

人脸检测属于目标检测(object detection) 的一部分，主要涉及两个方面

先对要检测的目标对象进行概率统计，从而知道待检测对象的一些特征，建立起目标检测模型。
用得到的模型来匹配输入的图像，如果有匹配则输出匹配的区域，否则什么也不做。

#### 原理
**目的**：人脸检测就是要判断一张图像是不是人脸，以及人脸的位置。  
**方法**：张大图像由他的一张很小的子图像窗口，以一定的倍数扩大（比如每次扩大 1.2 倍）暴力搜索，最终能确定位置。  
**核心**：判断一张图像是不是人脸，先提取图像的 haar-like 特征值，交给 adaboost 算法，它能判断是不是人脸。

人脸检测属于目标检测(object detection) 的一部分，主要涉及两个方面:
- 先对已知分类的目标对象进行概率统计，从而知道待检测对象的一些特征，建立起目标检测模型。
- 用得到的模型来匹配输入的图像，如果有匹配则输出匹配的区域，否则什么也不做。

#### 提取图片的 haar 特征
+ 为什么要提取 haar 特征？  
因为要用 adaboost 做分类，整张图塞进去计算量太大，提取一些主要的特征，能区分人脸非人脸就行。

+ 怎么提取 haar 特征？  
有大牛已经给出方法了，看下面的模板，把模板放在图像上，用 白色区域的灰度和 减去 黑色区域的灰度和，得到的数值就是其中一个 haar 特征，把模板在图像上滑动，能计算出一组数值，例如（123, 234, -134, ...），这就是图像的 haar 特征了。
![harr_template](https://upload-images.jianshu.io/upload_images/2764502-49382ffb6c163114.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)

+ 拓展  
图像区域快速求和，用积分图，对原图像进行一次积分，就能在$O(1)$时间算出区域像素和，大概写一下。假设积分图是 $F(x, y)$，求 $Rect(x, y, w, h)$ 区域和。  
$sum = F(x+w, y+h) - F(x+w, y) - F(x, y+h) + F(x, y)$


#### AdaBoost 算法

每来一张图片，提取其特征值 $\vec{X}$，用 AdaBoost 算法能判断出 $\vec{X}$ 是不是人脸。
AdaBoost 里面有很多个分类器对特征值 $\vec{X}$ 进行打分，分数有正有负，每个分类器还有个权值，最终把多个分类器给出的分数乘上他们自身的权值，全部累加起来，得到一个数值，如果是正数，表示属于 1 类，负数表示属于 -1 类。假设 1 类是人脸类，-1 类是非人脸类，就能分出一张图是不是人脸了。

分类器可以理解为一个函数 $G(x)$，输入特征值 $x$，返回数值 $G(x)$

AdaBoost 里面有多个弱分类器 (假设3个)，组合成一个强分类器，像这样

$G(x) = G_1(x)+ G_2(x) + G_3(x)$

每个弱分类器有权重

$G(x) = w_1G_1(x)+ w_2G_2(x) + w_3G_3(x)$

再来个sign(n)函数，sign 返回 n 前面的正负号，0和正数返回 1，负数返回 -1

$G(x) = sign(w_iG_1(x)+ w_2G_2(x) + w_3G_3(x))$

拓展到 n，最终的判断公式为

$G(x) = sign(\sum_{i=i}^{n}w_iG_i(x))$

输入一个图像的特征值 x，看看返回是 1 还是 -1，就可以判断出是人脸还是非人脸。

其中，$w_1$, $w_2$, $w_3$ 一开始不知道是多少，需要训练数据进行多轮的迭代后算出，训练过程就是调整权值的过程。训练完了后，就用这些权值组成的模型，对未知的图像进行分类。

#### 人脸特征
主要包括基本特征、肤色特征、变换域特征、统计特征四类特征。

##### 基本特征
+ 灰度特征  
  - 人脸区域内具有明显的灰度分布特征。眉、眼和嘴等区域的灰度值较低，前额、脸颊、鼻梁和下颌等区域的灰度值较高。利用这些信息，可以建立简单的人脸模板，用于粗检。例如，多个人脸图像的平均就是一个简单的人脸模板，类似的眼模板和嘴模板也常常使用。  
  - 人脸具有明显的灰度梯度分布特征。在人脸区域进行水平和垂直方向的灰度投影，根据极小点的位置可以得到眉、眼、鼻和嘴等器官所处的大致区域。光照不均对灰度特征有很大的影响。但在偏光的情况下，眼和嘴、鼻和嘴、鼻和脸颊等区域灰度的比值会保持一定的比率。根据这个特点，可采用线性光照拟合和直方图均衡的方法来补偿光照的影响。Log、Exp和LogAbout等一些非线性变换也可用于光照补偿。
+ 边缘和形状特征  
  - 人脸及人脸器官具有典型的边缘和形状特征，如人脸轮廓、眼睑轮廓、虹膜轮廓、眉毛边缘、鼻侧线和嘴唇轮廓等均可近似视为椭圆、圆、弧线或线段等简单的几何单元。可采用Sobel、Laplacian和Canny等算子或小波变换提取这些边缘特征。    
  - 噪声的存在会导致边缘的不连续，常采用边缘跟踪器把属于同一轮廓的各段边缘连接起来，并通过约束搜索范围防止边缘跟踪失败。数学形态学的腐蚀与膨胀运算与Hough变换也常用于提取人脸轮廓特征，并对噪声有较好的适应性。应用Snakes模型或主动形状模型（ASM，Active Shape Model）能够较好地抽取人脸的边缘特征，但这些模型需要一个较好的初始化位置。  
  - 尽管在强光照变化下也会产生一些伪边缘，但相对于灰度特征，边缘特征对光照变化具有一定的鲁棒性。
  - 面部器官如眉毛、眼睛、鼻子、嘴等，是按一定位置关系组织在一起的。各器官按照从上而下的顺序排列，相对位置保持不变。各器官间还存在着一些几何关系，比如两眼和嘴中心构成一个三角形、鼻子的中心大致位于这个三角形的中心等。
  - 根据这些结构特征，配合前面介绍的灰度特征和边缘、形状特征，可以建立基本的规则，区分人脸区域与背景。
+ 结构特征  
  - 结构特征主要表现在人脸的对称性和各个器官的空间位置分布。  
  - 人脸在结构上的对称性是十分有用的特征。正面人脸左右对称，对应位置上的边缘和灰度特征基本一致；同时，各个器官也具有自身的对称性，比如双眼、鼻子、耳朵等。
+ 纹理特征
  - 人脸具有特定的纹理分布特征，基于灰度共生（SGLD，Space Grey Level Dependency）矩阵建立人脸纹理特征模型，得到表征人脸的一系列纹理特征。





