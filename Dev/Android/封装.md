# 关于网络库的封装

## 1. 主要任务

网络库封装主要是为了更加方便地完成三大类任务：  
**1. 基本的 HTTP 请求**  
**2. 文件下载**  
**3. 附件上传**  

由于移动端APP的数据请求主要的时延来自于网络传输（受网络情况的影响很大）。所以需要对部分非实时敏感的数据进行合理的缓存。这就需要做好相应的缓存处理。

## 2. 数据缓存

三级缓存策略，即：内存->数据库->文件

按数据的敏感性、重要程度以及复杂程度指定合理的存储策略。譬如，将 
- token，sign，登录状态等简单且极其重要的信息且一般比较简单，存放在内存中；  
- 将个人信息、模块布局及其权限信息存放在数据库中；  
- 将图片、PDF、Word、视频、音频等文件缓存到文件。  

## 3. 返回结果处理

对于 HTTP 请求返回回来的数据，有json格式数据，xml格式，普通字符串等等，多以字符串为主。现在比较常见的是 JSON 格式字符串。如果客户端和服务器端的开发者，在进行开发前定义好返回的 json 格式并且开发过程中都按照约定好的格式进行编码，这样客户端就可以对返回的数据进行适当的处理，比如对服务器端返回的异常信息进行处理。但是在现实的开发中，不可能存在如此理想的情况。经常出现开发人员的变动，调用第三方的服务等等，因此要对不满足规范的服务返回结果处理延迟到具体的业务中。

## 4. 统一的异常处理

由于网络环境或API服务耗时或服务器程序、权限等因素的影响，可能会导致API请求超时，或服务异常，或者无权访问，或者请求参数异常等等，这些错误都是APP的开发无法控制的，主要来至于 API 服务的提供方，因此对这一类异常可以进行统一处理，减少代码的冗余和异常处理的多样性。


## 5. 重连机制  

APP HTTP 请求受网络环境的影响是非常大，尤其是在网络信号较差的山区，野外，隧道，山洞等等，在人流超大的场合受基站负荷的影响也是非常大的。可能穿过山洞或隧道信号又立即恢复，因此需要我们不断的重试，又可以建立连接获取到后端服务商提供的服务，因此需要建立合理的重连机制，在网络断开时，再次请求建立连接。